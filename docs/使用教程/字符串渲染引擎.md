---
sidebar_position: 5
title: 字符串渲染引擎
id: string
---

# 字符串渲染引擎

在 Yuml 中，几乎所有参数都会在运行前经过字符串渲染引擎的处理。  
该引擎负责将 `{<>}` 中的表达式执行（`eval`），并根据后缀控制返回类型。

---

## 核心功能

- **执行 `{<表达式>}` 中的代码，默认返回字符串。**  
- 支持后缀控制返回类型：  
  - `:obj` —— 返回 Python 对象本身  
  - `:int` —— 返回整数类型（将表达式结果转换为 int）  

---

## 详细说明

1. **表达式示例：**

  - `{< 1 + 1 >}` → 返回字符串 `"2"`  
  - `{< 1 + 1 >} :int` → 返回整数 `2`  
  - `{< 1 + 1 >} :obj` → 返回整数 `2`（Python 对象）

2. **不会额外增加更多类型转换，避免可读性降低。**  
   复杂类型转换建议使用 `:obj`，例如：  
  - `{< True >} :obj` → `True` (bool 类型)  
  - `{< float(1) >} :obj` → `1.0` (float 类型)

3. **对象示例：**

  - `{< MyClass() >}` → 返回对象的字符串表示，例如 `'MyClass'`  
  - `{< MyClass() >} :obj` → 返回对象实例本身  
  - `{< MyClass() >} :int` → 会触发 `ValueError`

4. **转义表达式：**

  - `{<< 1+1 >>}` 会被转为 `{< 1+1 >}`，但**不会被执行**，类似 Python f-string 中的双括号转义。  
  - 例如：

    - `{< 1+1 >} :int` → 返回 `2`  
    - `{<< 1+1 >>} :int` → 返回字符串 `'{<1+1>} :int'`（未执行）

5. **多表达式处理规则：**

  - `{< a >} {< b >} :obj` → 返回最后一个表达式的结果，即 `b`  
  - `{< 1 >}{< 2 >} :int` → 先拼接为字符串 `"12"`，再转换为整数 `12`  
  - `{< 1 >} {< 2 >} :int` → 因包含空格，会抛出 `ValueError`（无法转换 `"1 2"` 为整数）

---

## 使用示例

```yaml
LOG: "{< 1+1 >}"
```

输出： 2

---

该引擎是 Yuml 的核心功能之一，支持动态表达式渲染，增强了模板的灵活性和扩展性。