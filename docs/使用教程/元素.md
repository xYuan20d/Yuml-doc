---
sidebar_position: 4
title: 元素机制
id: mainBlocks
---

# 🧱 Yuml 元素机制详解 (main_block)

Yuml 的每一个 UI 与逻辑元素都通过**块**的方式表达，而具体的执行逻辑由 `main_block` 函数驱动。  
本篇文档将详细解析 `main_block` 所支持的元素及其语义。

---

## 🧩 块的语义构成

每个块的结构如下：

块名:  
  元素名: 参数

其中：

- `块名` 是根节点，用于标识一个 Block；
- `元素名` 是具体要执行的功能；
- `参数` 是对应的配置或调用参数。

---

## ⚙️ 支持的元素与功能

### 📐 窗口类元素

| 元素名        | 功能                             | 参数说明 |
|---------------|----------------------------------|-----------|
| `windowSize`  | 设置主窗口大小                   | `width`, `height` 字段 |
| `windowTitle` | 设置窗口标题                     | 字符串 |
| `windowIcon`  | 设置窗口图标                     | 图标路径 |
| `globalStyle` | 设置全局样式表（QSS）            | QSS 字符串 |
| `QssStyle`    | 等价于 `globalStyle`             | 同上 |

---

### 🧱 基础 UI 元素（由 `cw` 控制器处理）

| 元素名        | 功能         |
|---------------|--------------|
| `button`      | 创建按钮     |
| `label`       | 创建标签     |
| `listBox`     | 创建列表框   |
| `input`       | 创建输入框   |
| `YUML_WIDGET` | 加载子 Yuml 界面（嵌套） |

---

### 📦 容器元素

| 元素名 | 功能                                 |
|--------|--------------------------------------|
| `box`  | 创建多个 QWidget 容器并迁移内部元素 |

---

### 🧰 通用逻辑元素

| 元素名        | 功能                                 |
|---------------|--------------------------------------|
| `LOG`         | 控制台打印                           |
| `RETURN`      | 返回值到外部                         |
| `CALL_BLOCK`  | 调用其他块（支持字符串或列表）       |
| `callBlock`   | 同上，另一种语法形式                 |
| `HOOK`        | 执行钩子函数，将结果挂载到 hook 名   |
| `DELETE`      | 删除全局变量                         |
| `IMPORT`      | 设置导入路径（用于模块/插件系统）    |

---

### 🔁 控制流结构

| 元素名     | 功能                               |
|------------|------------------------------------|
| `WHILE`    | 条件循环，支持 COND / CODE / ELSE |
| `FOR`      | 遍历结构，支持 ITER / CODE / NAME / ELSE |
| `IF`       | 条件判断，支持多个条件块与 ELSE 分支 |
| `CONTINUE` | 跳过当前循环                       |
| `BREAK`    | 跳出当前循环                       |

---

### 🧬 脚本执行元素

| 元素名         | 功能                      |
|----------------|---------------------------|
| `PythonScript` | 执行 Python 脚本         |
| `LuaScript`    | 执行 Lua 脚本             |
| `YuanGuiScript`| 执行 YuanGui 自定义脚本   |

---

### ⛓️ 特殊符号块名说明

当块名以以下前缀符号开头时，会触发特殊语义：

| 前缀符号 | 功能语义 |
|----------|----------|
| `\=`     | 设置全局变量（字符串值） |
| `\>`     | 设置全局变量（表达式或 `.accept`） |
| `\#`     | 执行代码块作为 HOOK     |
| `$`      | 调用全局变量（函数或对象链式调用） |

示例：
```yaml
\=myVar: 123  
\>result: "1 + 2"  
$sum::doAdd: [1, 2]
```
---

## `组件元素`和`普通元素`

Yuml 中的元素分为 **组件元素** 与 **普通元素**：

- **普通元素** 是由 `main_block` 函数直接处理的块，如 `LOG`、`FOR`、`IF` 等。
- **组件元素** 是 UI 组件中的子元素，统一由 `cw` 控制器托管。

组件元素不能在组件外部块中使用，必须定义在如 `button`、`label` 等组件块内部。

示例：
```yaml
button:  
  button1:  
    show: true  # 组件元素1  
    onClicked: buttonClicked  # 组件元素2
```
---

### 📦 `通用组件元素`和`专有组件元素`

组件元素分为：

- **通用组件元素**：适用于所有组件，如 `show`, `size`, `move`, `QssStyle`；
- **专有组件元素**：只适用于特定组件，如 `onClicked` 是 `button` 独有。

---

## 📚 通用组件元素支持列表

以下为组件中通用支持的元素及功能说明：

| 元素名         | 功能                         |
|----------------|------------------------------|
| `show`         | 控制组件显示/隐藏            |
| `move`         | 设置组件位置（x, y）         |
| `size`         | 设置组件大小（width, height）|
| `X` / `Y`      | 单独设置横/纵坐标位置        |
| `width`        | 设置宽度                     |
| `height`       | 设置高度                     |
| `moveTo`       | 将组件移动到其他组件的位置   |
| `QssStyle`     | 设置组件样式                 |
| `id`           | 设置组件对象名               |
| `onMoved`      | 绑定移动事件                 |
| `styleTo`      | 复制另一个组件的样式、状态等 |
| `name`         | 重命名组件全局引用名         |
| `onList`       | 将组件加入指定列表（全局）   |
| `darkStyle`    | 设置暗色主题样式             |
| `lightStyle`   | 设置亮色主题样式             |
| `parent`       | 设置父组件                   |
| `delGlobals`   | 删除组件对应的全局引用       |

其他不在此表中的会默认从插件(包)中进行读取, 若还没有将抛出id为`NoBlockError`的<span style={{ color: 'red' }}>ERROR</span>
